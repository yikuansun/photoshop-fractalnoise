<script src="./FractalNoise.js"></script>

<canvas id="canvas" width="1024" height="1024"></canvas>

<script>
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");

    var noise = new FractalNoise(canvas.width, canvas.height, {
        baseFrequency: [0.01, 0.01],
        type: "fractalNoise",
        numOctaves: 10,
        seed: 1,
        stitchTiles: "stitch"
    });

    noise.canvas = canvas;
    noise.render();

    window.addEventListener("message", (e) => {
        console.log(e.data);
        if (e.data.type === "setNoiseOptions") {
            noise.setOptions(e.data.data);
            noise.render();
        }
        else if (e.data.type === "requestExportLayer") {
            let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            window.uxpHost.postMessage({
                type: "exportLayer",
                data: Array.from(imageData.data),
            });
        }
        else if (e.data.type === "updateDimensions") {
            noise.width = e.data.data.width;
            noise.height = e.data.data.height;
            noise.render();
        }
    });
</script>

<style>
    canvas {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }
</style>