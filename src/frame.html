<script src="./FractalNoise.js"></script>

<canvas id="canvas" width="1024" height="1024"></canvas>

<script>
    /** @type {HTMLCanvasElement} */
    let canvas = document.getElementById("canvas");
    let ctx = canvas.getContext("2d");

    let noise = new FractalNoise(canvas.width, canvas.height, {
        baseFrequency: [0.01, 0.01],
        type: "fractalNoise",
        numOctaves: 10,
        seed: 1,
        stitchTiles: "stitch"
    });

    let filter = "";

    function drawNoise() {
        noise.render();
        canvas.width = noise.width;
        canvas.height = noise.height;
        ctx.filter = filter;
        ctx.drawImage(noise.canvas, 0, 0);
    }
    drawNoise();

    window.addEventListener("message", (e) => {
        console.log(e.data);
        if (e.data.type === "setNoiseOptions") {
            noise.setOptions(e.data.data);
            drawNoise();
        }
        else if (e.data.type === "requestExportLayer") {
            let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            window.uxpHost.postMessage({
                type: "exportLayer",
                data: Array.from(imageData.data),
            });
        }
        else if (e.data.type === "updateDimensions") {
            noise.width = e.data.data.width;
            noise.height = e.data.data.height;
            drawNoise();
        }
        else if (e.data.type === "setFilter") {
            filter = "";
            if (e.data.data.invert) filter += "invert(100%)";
            if (e.data.data.desaturate) filter += "saturate(0%)";
            drawNoise();
        }
    });
</script>

<style>
    canvas {
        width: 100%;
        height: 100%;
        object-fit: contain;
    }
</style>